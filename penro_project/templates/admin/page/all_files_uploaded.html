{% extends "admin/layout/base.html" %}
{% block title %}All Uploaded Files{% endblock %}
{% block page_title %}All Uploaded Files{% endblock %}

{% block content %}

<div class="card shadow-sm">

  <!-- =========================
       FILTER PANEL
  ========================== -->
  <div class="card-body border-bottom">
    <form method="get" class="row g-3 align-items-end">

      <!-- YEAR -->
      <div class="col-md-2">
        <label class="form-label small">Year</label>
        <select name="year" class="form-select form-select-sm">
          <option value="">All</option>
          {% for y in filters.years %}
            <option value="{{ y }}" {% if active.year == y %}selected{% endif %}>
              {{ y }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- ATTACHMENT TYPE -->
      <div class="col-md-2">
        <label class="form-label small">Attachment Type</label>
        <select name="type" class="form-select form-select-sm">
          <option value="">All</option>
          {% for val,label in filters.attachment_types %}
            <option value="{{ val }}" {% if active.type == val %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- DIVISION -->
      <div class="col-md-2">
        <label class="form-label small">Division</label>
        <select name="division" class="form-select form-select-sm">
          <option value="">All</option>
          {% for d in filters.divisions %}
            <option value="{{ d }}" {% if active.division == d %}selected{% endif %}>
              {{ d }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- SERVICE -->
      <div class="col-md-2">
        <label class="form-label small">Service</label>
        <select name="service" class="form-select form-select-sm">
          <option value="">All</option>
          {% for s in filters.services %}
            <option value="{{ s }}" {% if active.service == s %}selected{% endif %}>
              {{ s }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- UNIT -->
      <div class="col-md-2">
        <label class="form-label small">Unit</label>
        <select name="unit" class="form-select form-select-sm">
          <option value="">All</option>
          {% for u in filters.units %}
            <option value="{{ u }}" {% if active.unit == u %}selected{% endif %}>
              {{ u }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- ACTIONS -->
      <div class="col-md-2 d-flex gap-2">
        <button class="btn btn-primary btn-sm w-100">
          <i class="fas fa-filter me-1"></i> Apply
        </button>
        <a href="{% url 'admin_app:all-files-uploaded' %}"
           class="btn btn-outline-secondary btn-sm w-100">
          Reset
        </a>
      </div>

    </form>
  </div>

  <!-- =========================
       TABLE HEADER
  ========================== -->
  <div class="card-body pb-0">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h6 class="fw-semibold mb-0">
        <i class="fas fa-file-alt me-2"></i>
        All Uploaded Files
      </h6>
      <span class="text-muted small">
        {{ total_files }} total files
      </span>
    </div>
  </div>

  <!-- =========================
       FILES TABLE
  ========================== -->
  <div class="table-responsive">
    <table class="table table-hover align-middle small mb-0">

      <thead class="table-light">
        <tr>
          <th>File Name</th>
          <th>Type</th>
          <th>Workcycle</th>
          <th>Division</th>
          <th>Unit</th>
          <th>Uploaded By</th>
          <th>Date Uploaded</th>
          <th class="text-end">Action</th>
        </tr>
      </thead>

      <tbody>
      {% for f in files %}
        <tr>
          <td class="fw-semibold">
            {{ f.name }}
          </td>

          <td>
            <span class="badge bg-secondary">
              {{ f.type }}
            </span>
          </td>

          <td>{{ f.workcycle|default:"—" }}</td>
          <td>{{ f.division|default:"—" }}</td>
          <td>{{ f.unit|default:"—" }}</td>

          <td>
            {{ f.uploaded_by|default:"System" }}
          </td>

          <td>
            {{ f.uploaded_at|date:"M d, Y · H:i" }}
          </td>

          <td class="text-end">
            <a href="{{ f.file_url }}"
               target="_blank"
               class="btn btn-sm btn-outline-primary">
              Open
            </a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="8" class="text-center text-muted py-4">
            No files found for the selected filters
          </td>
        </tr>
      {% endfor %}
      </tbody>

    </table>
  </div>

</div>

{% endblock %}
