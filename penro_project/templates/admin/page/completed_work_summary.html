{% extends "admin/layout/base.html" %}
{% block title %}Work Assignment Analytics{% endblock %}

{% block content %}

<!-- HEADER -->
<div class="mb-4 d-flex justify-content-between align-items-start flex-wrap gap-3">
  <div>
    <h3 class="fw-bold d-flex align-items-center gap-2 mb-1">
      <i class="fas fa-chart-bar text-primary"></i>
      Work Assignment Analytics
    </h3>
    <p class="text-muted mb-0">
      Status and review breakdown per active work cycle
    </p>
  </div>

  <!-- VIEW TOGGLE -->
  <div class="btn-group shadow-sm" role="group">
    <button type="button" class="btn btn-outline-secondary active" id="listViewBtn">
      <i class="fas fa-list"></i>
    </button>
    <button type="button" class="btn btn-outline-secondary" id="cardViewBtn">
      <i class="fas fa-th-large"></i>
    </button>
  </div>
</div>

{% if summary %}

<div id="listView">
  {% include "admin/page/_completed_work_list.html" %}
</div>

<div id="cardView" class="d-none">
  {% include "admin/page/_completed_work_cards.html" %}
</div>

{% else %}
<div class="p-4 text-muted text-center fst-italic">
  <i class="far fa-folder-open me-1"></i>
  No analytics data available
</div>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const listBtn = document.getElementById("listViewBtn");
  const cardBtn = document.getElementById("cardViewBtn");
  const list = document.getElementById("listView");
  const card = document.getElementById("cardView");

  listBtn.onclick = () => {
    list.classList.remove("d-none");
    card.classList.add("d-none");
    listBtn.classList.add("active");
    cardBtn.classList.remove("active");
  };

  cardBtn.onclick = () => {
    card.classList.remove("d-none");
    list.classList.add("d-none");
    cardBtn.classList.add("active");
    listBtn.classList.remove("active");
  };
});

document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".progressPie").forEach(canvas => {
    const done = Number(canvas.dataset.done);
    const total = Number(canvas.dataset.total);
    const remaining = Math.max(total - done, 0);

    new Chart(canvas, {
      type: "doughnut",
      data: {
        labels: ["Done", "Remaining"],
        datasets: [{
          data: [done, remaining],
          backgroundColor: ["#10b981", "#e5e7eb"],
          borderWidth: 0
        }]
      },
      options: {
        cutout: "70%",
        plugins: {
          legend: { display: false },
          tooltip: { enabled: true }
        }
      }
    });
  });
});


</script>

{% endblock %}
