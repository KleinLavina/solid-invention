{% extends "admin/layout/base.html" %}
{% load static %}

{% block title %}Workers | {{ deadline.title }}{% endblock %}
{% block page_title %}Workers Assigned to "{{ deadline.title }}"{% endblock %}

{% block content %}

<style>
.worker-card {
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    padding: 1rem;
    transition: transform .2s ease, box-shadow .2s ease;
}
.worker-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.08);
}
.status-badge {
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
}
</style>

<h4 class="mb-4">
    <strong>{{ deadline.title }}</strong><br>
    <small class="text-muted">Department: {{ deadline.department.name }}</small>
</h4>
 <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="mb-0">All Report Deadlines</h4>

        <button class="btn btn-primary"
                data-bs-toggle="modal"
                onclick="window.location.href='/main/admin/deadlines/'">
            + Schedule & Assign Deadline
        </button>
    </div>
<div class="row g-3">

{% for w in workers %}
    <div class="col-md-4">
        <div class="worker-card">

            <div class="d-flex justify-content-between">
                <h6 class="fw-bold mb-1">{{ w.user.get_full_name }}</h6>

                {% if w.obj.status == "pending" %}
                    <span class="status-badge bg-secondary text-white">Pending</span>

                {% elif w.obj.status == "in_progress" %}
                    <span class="status-badge bg-info text-dark">In Progress</span>

                {% elif w.obj.status == "late" %}
                    <span class="status-badge bg-warning text-dark">Late</span>

                {% elif w.obj.status == "overdue" %}
                    <span class="status-badge bg-danger text-white">Overdue</span>

                {% elif w.obj.status == "complete" %}
                    <span class="status-badge bg-success text-white">Complete</span>
                {% endif %}
            </div>

            <p class="text-muted small mb-2">
                {{ w.user.position_title|default:"No position listed" }}
            </p>

            <hr>

            <!-- Status details -->
            {% if w.obj.status == "pending" %}
                <small class="text-muted">Not started yet</small>

            {% elif w.obj.status == "in_progress" %}
                <small class="text-muted">
                    {{ w.remaining_days }} day{{ w.remaining_days|pluralize }} remaining
                </small>

            {% elif w.obj.status == "late" %}
                <small class="text-danger">
                    Late by {{ w.lateness_days }} days
                </small>

            {% elif w.obj.status == "overdue" %}
                <small class="text-danger">Overdue â€” no submission</small>

            {% elif w.obj.status == "complete" %}
                <small class="text-success">
                    Submitted on {{ w.obj.submitted_at|date:"M j, Y" }}
                </small>
            {% endif %}

        </div>
    </div>
{% empty %}
    <p class="text-muted">No workers found under this deadline.</p>
{% endfor %}

</div>

{% endblock %}
