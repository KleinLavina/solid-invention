{% extends "admin/layout/base.html" %}
{% block title %}Work Status â€” {{ workcycle.title }}{% endblock %}

{% block content %}

<!-- PAGE HEADER -->
<div class="mb-4 d-flex justify-content-between align-items-start flex-wrap gap-3">

  <div>
    <h3 class="mb-1 fw-bold d-flex align-items-center gap-2">
      <i class="fas fa-tasks text-primary"></i>
      {{ workcycle.title }}
    </h3>

    <div class="text-muted small d-flex align-items-center gap-3 mt-1">
      <span>
        <i class="far fa-calendar-alt me-1"></i>
        Due {{ workcycle.due_at|date:"M d, Y Â· H:i" }}
      </span>
    </div>

    {% if workcycle.description %}
    <div class="mt-2 text-muted">
      <i class="fas fa-align-left me-1"></i>
      {{ workcycle.description }}
    </div>
    {% endif %}
  </div>

  <div>
    <a href="javascript:history.back()"
       class="btn btn-outline-secondary shadow-sm d-flex align-items-center gap-1">
      <i class="fas fa-arrow-left"></i>
      Back
    </a>
  </div>

</div>

<!-- DONE WORKERS -->
<div class="card ui-card mb-4">
  <div class="card-header ui-card-header d-flex align-items-center gap-2">
    <i class="fas fa-check-circle text-success"></i>
    <strong>Workers Marked as Done</strong>
    <span class="text-muted small ms-2">
      (Requires review)
    </span>
  </div>

  <div class="card-body p-0">
    {% if done_items %}
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Worker</th>
          <th>Status</th>
          <th>Review Status</th>
          <th>Submitted</th>
          <th class="text-end">Review Action</th>
        </tr>
      </thead>

      <tbody>
        {% for item in done_items %}
        <tr class="review-row">

          <!-- WORKER -->
          <td>
            <i class="far fa-user me-1 text-muted"></i>
            {{ item.owner.get_full_name|default:item.owner.username }}
          </td>

          <!-- SUBMISSION STATUS -->
          <td>
            <span class="badge ui-badge status text-success">
              <i class="fas fa-check me-1"></i>
              Done
            </span>
          </td>

          <!-- REVIEW DECISION STATUS -->
          <td>
            {% if item.review_decision == "approved" %}
              <span class="badge bg-success">
                <i class="fas fa-check-circle me-1"></i>
                Approved
              </span>
            {% elif item.review_decision == "revision" %}
              <span class="badge bg-danger">
                <i class="fas fa-undo me-1"></i>
                Needs Revision
              </span>
            {% else %}
              <span class="badge bg-warning text-dark">
                <i class="fas fa-hourglass-half me-1"></i>
                Pending Review
              </span>
            {% endif %}
          </td>

          <!-- SUBMITTED TIME -->
          <td>
            {% if item.submitted_at %}
              <div class="d-flex flex-column">
                <span>
                  <i class="far fa-clock me-1 text-muted"></i>
                  {{ item.submitted_at|date:"M d, Y Â· H:i" }}
                </span>

                {% if item.submitted_at > workcycle.due_at %}
                  <span class="badge bg-danger mt-1 align-self-start">
                    <i class="fas fa-exclamation-triangle me-1"></i>
                    Late
                  </span>
                {% else %}
                  <span class="badge bg-success mt-1 align-self-start">
                    <i class="fas fa-check-circle me-1"></i>
                    On time
                  </span>
                {% endif %}
              </div>
            {% else %}
              â€”
            {% endif %}
          </td>

          <!-- REVIEW ACTION -->
          <td class="text-end">
            <a href="{% url 'admin_app:work-item-review' item.id %}"
              class="btn btn-sm
              {% if item.review_decision == 'approved' %}
                btn-outline-success
              {% elif item.review_decision == 'revision' %}
                btn-outline-danger
              {% else %}
                btn-primary
              {% endif %}
              d-inline-flex align-items-center gap-2 shadow-sm">
              <i class="fas fa-eye"></i>
              {% if item.review_decision == "approved" %}
                View Review
              {% elif item.review_decision == "revision" %}
                Re-review
              {% else %}
                Review
              {% endif %}
            </a>
          </td>

        </tr>
        {% endfor %}
      </tbody>
    </table>


    {% else %}
      <div class="p-3 text-muted fst-italic">
        <i class="far fa-folder-open me-1"></i>
        No workers marked as done
      </div>
    {% endif %}
  </div>
</div>

<!-- ONGOING / NOT STARTED -->
<div class="card ui-card border-warning">
  <div class="card-header ui-card-header text-warning d-flex align-items-center gap-2">
    <i class="fas fa-hourglass-half"></i>
    Workers Still In Progress / Not Started
  </div>

  <div class="card-body p-0">
    {% if ongoing_items %}
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Worker</th>
          <th>Status</th>
        </tr>
      </thead>

      <tbody>
        {% for item in ongoing_items %}
        <tr>
          <td>
            <i class="far fa-user me-1 text-muted"></i>
            {{ item.owner.get_full_name|default:item.owner.username }}
          </td>

          <td>
            {% if item.status == "working_on_it" %}
              <span class="badge ui-badge status text-info">
                <i class="fas fa-spinner me-1"></i>
                Working on it
              </span>
            {% else %}
              <span class="badge ui-badge status text-secondary">
                <i class="far fa-circle me-1"></i>
                Not started
              </span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {% else %}
      <div class="p-3 text-muted fst-italic">
        <i class="far fa-smile me-1"></i>
        All workers are done ðŸŽ‰
      </div>
    {% endif %}
  </div>
</div>

{% endblock %}
