    {% extends "admin/layout/base.html" %}
    {% load static %}

    {% block title %}Deadlines{% endblock %}
    {% block page_title %}Deadline Submission Overview{% endblock %}

    {% block content %}

    <style>
    /* CARD */
    .deadline-card { 
        border-radius: 12px;
        padding: 1.25rem;
        transition: transform .2s ease, box-shadow .2s ease;
        border: 1px solid #e5e7eb;
    }
    .deadline-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 12px 28px rgba(0,0,0,0.12);
    }

    /* TITLE */
    .deadline-title { 
        font-size: 1.15rem; 
        font-weight: 700;
        margin-bottom: .25rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* BADGES */
    .badge-status { 
        font-size: .8rem; 
        padding: 6px 10px; 
        border-radius: 6px;
    }

    .card-footer-small { font-size: 0.85rem; color: #6c757d; }

    /* ==========================================
    NEW MODERN PROGRESS BAR
    ========================================== */
    .progress-modern {
        position: relative;
        height: 12px;
        width: 100%;
        background: #e5e7eb;
        border-radius: 999px;
        overflow: hidden;
    }

    /* Green bar */
    .progress-green {
        height: 100%;
        background: linear-gradient(90deg, #198754, #2ecc71);
        width: 0%;
        transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }

    /* Shimmer effect */
    .progress-green::after {
        content: "";
        position: absolute;
        inset: 0;
        background-image: linear-gradient(
            120deg,
            rgba(255,255,255,0.25),
            rgba(255,255,255,0.05),
            transparent
        );
        background-size: 200% 200%;
        animation: shimmer 2s infinite linear;
        opacity: 0.4;
    }

    @keyframes shimmer {
        from { background-position: 200% 0; }
        to { background-position: -200% 0; }
    }

    /* Yellow late overlay */
    .progress-late {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 0%;
        background: repeating-linear-gradient(
            45deg,
            rgba(255, 193, 7, 0.85),
            rgba(255, 193, 7, 0.85) 6px,
            rgba(255, 193, 7, 0.65) 6px,
            rgba(255, 193, 7, 0.65) 12px
        );
        border-radius: 999px;
        transition: width 1.2s ease;
        mix-blend-mode: multiply;
    }
    </style>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("[data-progress]").forEach(el => {
            const value = el.dataset.progress || 0;
            el.style.width = value + "%";
        });
    });
    </script>
    <!-- Header Row -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="mb-0">All Report Deadlines</h4>

        <button class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#createModal">
            + Schedule & Assign Deadline
        </button>
    </div>


    <div class="row g-4">

    {% for d in deadlines %}
        <div class="col-md-4">
             <div class="card deadline-card h-100"
             onclick="window.location.href='/main/admin/deadlines/{{ d.obj.id }}/statuses/'">

                <!-- Title + Status -->
                <div class="d-flex justify-content-between align-items-start">
                    <h5 class="deadline-title">{{ d.obj.title }}</h5>

                    {% if d.completion_pct == 100 %}
                        <span class="badge bg-success badge-status">Completed</span>
                    {% elif d.days_remaining < 0 %}
                        <span class="badge bg-danger badge-status">Overdue</span>
                    {% elif d.days_remaining <= 3 %}
                        <span class="badge bg-warning text-dark badge-status">Due Soon</span>
                    {% else %}
                        <span class="badge bg-info text-dark badge-status">Active</span>
                    {% endif %}
                </div>

                <!-- Department -->
                <p class="text-muted small mt-2">
                    <strong>Department:</strong> {{ d.department.name }}
                </p>

                <!-- Description -->
                <p class="text-muted small mb-2">
                    {{ d.obj.description|default:"No description provided."|truncatechars:120 }}
                </p>

                <hr>

                <!-- Dates -->
                <p class="small mb-1"><strong>Start:</strong> {{ d.start_date|date:"M j, Y" }}</p>
                <p class="small mb-2"><strong>Deadline:</strong> {{ d.deadline_date|date:"M j, Y" }}</p>

                <!-- PROGRESS BAR -->
                {% if d.show_progress %}
                <div class="mt-2">

                    <div class="progress-modern">
                        
                        <!-- Green base -->
                        <div class="progress-green" 
                            data-progress="{{ d.completion_pct }}">
                        </div>

                        <!-- Yellow late overlay -->
                        {% if d.late_overdue_count > 0 %}
                        <div class="progress-late"
                            data-progress="{{ d.late_overdue_count }}">
                        </div>
                        {% endif %}
                    </div>

                    <!-- Remaining Days -->
                    {% if d.days_remaining >= 0 %}
                        <small class="text-muted d-block mt-1">
                            {{ d.days_remaining }} day{{ d.days_remaining|pluralize }} remaining
                        </small>
                    {% else %}
                        <small class="text-danger d-block mt-1">
                            Overdue by {{ d.days_remaining|stringformat:"d"|cut:"-" }} days
                        </small>
                    {% endif %}

                    <div class="d-flex justify-content-between align-items-center mt-1">
                        <small class="card-footer-small">
                            {{ d.complete_count }} / {{ d.total_expected }} completed
                        </small>
                        <small class="card-footer-small">{{ d.completion_pct }}%</small>
                    </div>

                </div>
                {% endif %}

                <!-- Actions -->
                <div class="mt-3 d-flex gap-2">
                    <button class="btn btn-sm btn-outline-primary w-50"
            data-bs-toggle="modal"
            data-bs-target="#editModal{{ d.obj.id }}">
        Edit
    </button>

                    <button class="btn btn-sm btn-outline-danger w-50"
            data-bs-toggle="modal"
            data-bs-target="#deleteModal{{ d.obj.id }}">
        Delete
    </button>

                </div>

            </div>
        </div>

        {% include "admin/page/modals/edit_deadline_modal.html" with deadline=d.obj %}
        {% include "admin/page/modals/delete_deadline_modal.html" with deadline=d.obj %}
    {% endfor %}

    </div>

    {% include "admin/page/modals/create_deadline_modal.html" %}
    {% endblock %}
