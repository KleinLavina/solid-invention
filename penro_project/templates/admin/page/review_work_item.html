{% extends "admin/layout/base.html" %}
{% block title %}Review Work Item{% endblock %}

{% block content %}

<!-- HEADER -->
<div class="mb-4 d-flex justify-content-between align-items-start flex-wrap gap-3">

  <div>
    <h4 class="fw-bold mb-1 d-flex align-items-center gap-2">
      <i class="fas fa-eye text-primary"></i>
      Review Submission
    </h4>
    <div class="text-muted small">
      {{ work_item.workcycle.title }}
    </div>
  </div>

 <a href="{% url 'admin_app:done-workers-by-workcycle' work_item.workcycle.id %}"
   class="btn btn-outline-secondary btn-sm d-flex align-items-center gap-2 shadow-sm">
  <i class="fas fa-arrow-left"></i>
  Back to Done Workers
</a>

 

</div>

<!-- REVIEW CARD -->
<div class="card mb-3">
  <div class="card-header d-flex justify-content-between align-items-center">

    <!-- WORKER -->
    <div class="d-flex align-items-center gap-2">
      <i class="far fa-user text-muted"></i>
      <span class="fw-semibold">
        {{ work_item.owner.get_full_name|default:work_item.owner.username }}
      </span>
    </div>

    <!-- REVIEW STATUS BADGE -->
    <span class="badge
      {% if work_item.review_decision == 'approved' %}bg-success
      {% elif work_item.review_decision == 'revision' %}bg-danger
      {% else %}bg-warning text-dark{% endif %}">
      {{ work_item.get_review_decision_display }}
    </span>

  </div>

  <div class="card-body">

    <!-- SUBMISSION TIME -->
    <div class="mb-3 small text-muted d-flex align-items-center gap-2">
      <i class="far fa-clock"></i>
      <span>
        Submitted: {{ work_item.submitted_at|date:"M d, Y · H:i" }}
      </span>
    </div>

    <!-- STATUS LABEL -->
    <div class="mb-3">
      <strong class="small text-uppercase text-muted">
        Status Label
      </strong>
      <div class="small mt-1">
        {{ work_item.status_label|default:"—" }}
      </div>
    </div>

    <!-- MESSAGE -->
    <div class="mb-3">
      <div class="d-flex align-items-center gap-2 mb-1">
        <i class="fas fa-comment-dots text-primary"></i>
        <strong class="small text-uppercase text-muted">
          Worker Message
        </strong>
      </div>

      <div class="border rounded p-2 bg-light small">
        {{ work_item.message|linebreaksbr|default:"No message provided." }}
      </div>
    </div>

    <!-- REVIEW ACTIONS -->
    <div class="border-top pt-3 mt-3">

      <form method="post" class="d-flex gap-2 flex-wrap">
        {% csrf_token %}
        <input type="hidden" name="action" value="update_review">

        <button type="submit"
                name="review_decision"
                value="pending"
                class="btn btn-sm
                {% if work_item.review_decision == 'pending' %}
                  btn-warning
                {% else %}
                  btn-outline-warning
                {% endif %}">
          <i class="fas fa-hourglass-half me-1"></i>
          Pending Review
        </button>

        <button type="submit"
                name="review_decision"
                value="approved"
                class="btn btn-sm
                {% if work_item.review_decision == 'approved' %}
                  btn-success
                {% else %}
                  btn-outline-success
                {% endif %}">
          <i class="fas fa-check-circle me-1"></i>
          Approve
        </button>

        <button type="submit"
                name="review_decision"
                value="revision"
                class="btn btn-sm
                {% if work_item.review_decision == 'revision' %}
                  btn-danger
                {% else %}
                  btn-outline-danger
                {% endif %}">
          <i class="fas fa-undo me-1"></i>
          Needs Revision
        </button>
      </form>

      <!-- FUTURE CHAT BUTTON (STATIC) -->
      <div class="mt-3">
        <button type="button"
                class="btn btn-sm btn-outline-primary d-flex align-items-center gap-2"
                disabled>
          <i class="fas fa-comment-dots"></i>
          Send a message
          <span class="badge bg-secondary-subtle text-secondary ms-1">
            Coming soon
          </span>
        </button>
      </div>

    </div>

  </div>
</div>

<!-- ATTACHMENTS -->
<div class="card">
  <div class="card-header d-flex align-items-center gap-2">
    <i class="fas fa-paperclip"></i>
    Attachments
  </div>

  <div class="card-body">
    {% if work_item.attachments.all %}
      <ul class="list-group list-group-flush">
        {% for f in work_item.attachments.all %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <a href="{{ f.file.url }}" target="_blank"
             class="small text-decoration-none d-flex align-items-center gap-2">
            <i class="far fa-file text-muted"></i>
            {{ f.file.name|slice:"-40:" }}
          </a>
          <span class="small text-muted">
            {{ f.uploaded_at|date:"M d, Y · H:i" }}
          </span>
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="text-muted small fst-italic">
        No attachments submitted.
      </div>
    {% endif %}
  </div>
</div>

{% endblock %}
