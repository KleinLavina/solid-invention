{% extends "admin/layout/base.html" %}
{% block title %}Work Cycles{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-0">Work Cycles</h3>
    <small class="text-muted">Manage active and archived work cycles</small>
  </div>

  <button class="btn btn-success"
          data-bs-toggle="modal"
          data-bs-target="#createWorkcycleModal">
    <i class="fas fa-plus me-1"></i>
    Add Work Cycle
  </button>
</div>

{% if workcycles %}
<div class="row g-4">

  {% for wc in workcycles %}
  <div class="col-md-6 col-xl-4">
    <div class="card h-100 workcycle-card">

      <div class="card-body d-flex flex-column">

        
        
        <!-- Header -->
        <div class="card-header-row mb-2">

          <!-- Left: Title -->
          <div class="card-title-group pe-4">
            <span class="card-label">Work Cycle</span>
            <h5 class="fw-semibold mb-1 text-truncate">
              {{ wc.title }}
            </h5>

            {% if wc.is_active %}
              <span class="status-badge active">Active</span>
            {% else %}
              <span class="status-badge archived">Archived</span>
            {% endif %}
          </div>

          <!-- Right: Actions (ABSOLUTE) -->
          <div class="card-actions-absolute">
            <div class="dropdown">
              <button class="btn btn-sm btn-icon action-btn-bg"
                      type="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false">
                <i class="fas fa-ellipsis-h"></i>
              </button>

              <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                <li>
                  <a class="dropdown-item" href="#">
                    <i class="far fa-eye me-2"></i> View
                  </a>
                </li>
                <li>
                  <button type="button"
                          class="dropdown-item"
                          data-bs-toggle="modal"
                          data-bs-target="#editWorkcycleModal"
                          data-id="{{ wc.id }}"
                          data-title="{{ wc.title|escapejs }}"
                          data-description="{{ wc.description|default:''|escapejs }}"
                          data-due="{{ wc.due_at|date:'Y-m-d H:i' }}">
                    <i class="far fa-edit me-2"></i> Edit
                  </button>
                </li>
                <li>
                  <a class="dropdown-item"
                    href="#"
                    data-bs-toggle="modal"
                    data-bs-target="#reassignWorkcycleModal"
                    data-id="{{ wc.id }}"
                    data-title="{{ wc.title }}"
                    data-users="{% for a in wc.assignments.all %}{% if a.assigned_user %}{{ a.assigned_user.get_full_name|default:a.assigned_user.username }}{% if not forloop.last %},{% endif %}{% endif %}{% endfor %}"
                    data-teams="{% for a in wc.assignments.all %}{% if a.assigned_team %}{{ a.assigned_team.name }}{% if not forloop.last %},{% endif %}{% endif %}{% endfor %}">
                    <i class="fas fa-random me-2"></i> Reassign
                  </a>

                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item text-danger" href="#">
                    <i class="far fa-trash-alt me-2"></i> Delete
                  </a>
                </li>
              </ul>
            </div>
          </div>

        </div>




        <!-- Description -->
        <div class="mt-3">
          <span class="card-label">Description</span>
          {% if wc.description %}
          <p class="small text-muted description-clamp mb-0">
            {{ wc.description }}
          </p>
          {% else %}
          <p class="small text-muted fst-italic mb-0">
            No description provided
          </p>
          {% endif %}
        </div>

        <!-- Meta -->
        <div class="mt-auto pt-3 border-top meta-section">

          <div class="meta-item">
            <span class="meta-label">Due Date</span>
            <span class="meta-value">
              <i class="far fa-calendar me-1"></i>
              {{ wc.due_at|date:"M d, Y Â· H:i" }}
            </span>
          </div>

          <div class="meta-item mt-2">
            <span class="meta-label">Created By</span>
            <span class="meta-value">
              <i class="far fa-user me-1"></i>
              {{ wc.created_by|default:"System" }}
            </span>
          </div>

        </div>

      </div>
    </div>
  </div>
  {% endfor %}

</div>
{% else %}
<div class="card">
  <div class="card-body text-center text-muted py-5">
    <i class="fas fa-folder-open fa-2x mb-3"></i>
    <p class="mb-0">No work cycles yet.</p>
  </div>
</div>
{% endif %}


{% include "admin/page/modals/create_workcycle_modal.html" %}
{% include "admin/page/modals/edit_workcycle_modal.html" %}
{% include "admin/page/modals/reassign_workcycle_modal.html" %}

<!-- UI / UX Enhancements -->
<style>

/* Radiant white surface */
.workcycle-card {
  background: linear-gradient(180deg, #ffffff 0%, #fafbfc 100%);
  border-radius: 14px;
  border: 1px solid rgba(0,0,0,0.04);
  box-shadow: 0 6px 18px rgba(0,0,0,0.06);
  transition: transform 0.18s ease, box-shadow 0.18s ease;
}

.workcycle-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 14px 32px rgba(0,0,0,0.1);
}

/* Card labels */
.card-label {
  display: block;
  font-size: 0.68rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: #8a8f98;
  margin-bottom: 2px;
}

/* Status badges */
.status-badge {
  font-size: 0.7rem;
  font-weight: 600;
  padding: 4px 10px;
  border-radius: 999px;
}

.status-badge.active {
  background: rgba(25,135,84,0.12);
  color: #198754;
}

.status-badge.archived {
  background: rgba(108,117,125,0.12);
  color: #6c757d;
}

/* Meta section */
.meta-section {
  font-size: 0.8rem;
  color: #6c757d;
}

.meta-label {
  display: block;
  font-size: 0.65rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: #9aa0a6;
}

.meta-value {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Clamp description */
.description-clamp {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
/* Absolute action button positioning */
.card-actions-absolute {
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 2;
}

/* Icon button base */
.btn-icon {
  width: 32px;
  height: 32px;
  padding: 0;
  border-radius: 8px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Background surface to avoid blending */
.action-btn-bg {
  background: rgba(255, 255, 255, 0.85);
  border: 1px solid rgba(0,0,0,0.06);
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  backdrop-filter: blur(6px);
}

.action-btn-bg:hover {
  background: #ffffff;
}

</style>

{% endblock %}
