{% extends "admin/layout/base.html" %}

{% block title %}Workers — {{ dept_name }}{% endblock %}
{% block page_title %}Workers in {{ dept_name }}{% endblock %}

{% block content %}

<div class="d-flex justify-content-between mb-3">
    <a href="/main/admin/departments/" class="btn btn-secondary">← Back</a>

    <button class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#workerCreateModal">
        + Add Worker
    </button>
</div>

<div class="card p-3 shadow-sm">
    <h4 class="fw-bold mb-3">{{ dept_name }}</h4>

    {% if workers %}
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th>Username</th>
                <th>Position</th>
                <th>Contact</th>
                <th style="width: 130px;">Actions</th>
            </tr>
        </thead>

        <tbody>
            {% for worker in workers %}
            <tr>
                <td>{{ worker.get_full_name|default:"No Name" }}</td>
                <td>{{ worker.username }}</td>
                <td>{{ worker.position_title|default:"—" }}</td>
                <td>{{ worker.contact_number|default:"—" }}</td>

                <td>
                    <!-- EDIT BUTTON -->
                    <button class="btn btn-sm btn-outline-primary"
                            data-bs-toggle="modal"
                            data-bs-target="#workerEditModal{{ worker.id }}"
                            onclick="event.stopPropagation()">
                        Edit
                    </button>

                    <!-- DELETE BUTTON -->
                    <button class="btn btn-sm btn-outline-danger"
                            data-bs-toggle="modal"
                            data-bs-target="#workerDeleteModal{{ worker.id }}"
                            onclick="event.stopPropagation()">
                        Delete
                    </button>
                </td>
            </tr>

            {% include "admin/page/modals/worker_edit_modal.html" with worker=worker %}
            {% include "admin/page/modals/worker_delete_modal.html" with worker=worker %}
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="text-muted">No workers in this department.</p>
    {% endif %}
</div>

<!-- ALWAYS RENDER THE CREATE MODAL BELOW EVERYTHING -->
{% include "admin/page/modals/worker_add_modal.html" %}

{% endblock %}
